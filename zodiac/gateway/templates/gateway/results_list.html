{% extends "gateway/base.html" %}

{% block h1_title %}
  Results
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-12 type-filters">
    <p>Show result types:</p>
    <label>
      <div aria-checked="true" aria-disabled="false">
        <input id="success" type="checkbox" checked> Success
      </div>
    </label>
    <label>
      <div aria-checked="true" aria-disabled="false">
        <input id="error" type="checkbox" checked> Error
      </div>
    </label>
    <label>
      <div aria-checked="true" aria-disabled="false">
        <input id="idle" type="checkbox" checked> Idle
      </div>
    </label>
  </div>
  <div class="col-md-12">
    <div class="box box-primary">
      <div class="box-body {% if object_list %}no-padding{% endif %}">
        <table id="results-table" class="table table-striped dataTable">
          <thead>
            <th>Identifier</th>
            <th>Service</th>
            <th>Category</th>
            <th>Result</th>
            <th>Date</th>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
  $(document).ready(function() {
    var table = $('#results-table').DataTable({
      "columnDefs": [
        {
          width: "50%",
          targets: [3] }
      ],
			'stateSave'   : true,
      'paging'      : true,
      'lengthChange': false,
      'searching'   : true,
      'ordering'    : true,
      'order'       : [[ 3, 'desc' ]],
      'info'        : true,
      'autoWidth'   : true,
      'pageLength'  : 25,
			'processing': true,
      'serverSide': true,
      'ajax': '{% url "results-data" %}'
    });
    setInterval( function () {
      table.ajax.reload( null, false );
    }, 10000 );
    $('.type-filters').on('click', function() {
      filters = []
      active_types = $(this).find('input[type=checkbox]').each(function(){
        if ($(this).prop("checked")) {
          filters.push($(this).attr('id'))
        }
      });
      search = filters.join('|')
      // need to do some business in Ajax to facilitate this
      table.columns(2).search(search, true, false).draw()
    })
  });
  </script>
{% endblock %}
